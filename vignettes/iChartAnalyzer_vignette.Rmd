---
title: "How to use the iChartAnalyzeR Package"
author: "Kyle MacDonald"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using iChartAnalyzeR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

The `iChartAnalyzeR` package allows you to process and analyze and iChart in the style of the Language Learning Lab at
Stanford University. This vignette shows some examples of how to use the data loading, processing, and analysis functions 
and what the resulting data look like.

```{r, warning=FALSE, message=FALSE}
# load the library
library(iChartAnalyzeR)
```

## Analysis workflow 

### readiChart

This function reads in a wide formatted data .txt file that was generated by the companion `Rtobii` package.

```{r}
# d <- readiChart(iChartFile = "Habla2_25_iChart_wide.txt", sampling_rate = 17)
d <- demo_data
```

We can use the `describeiChart()` function to quickly display some descriptive information about the number of trials for each participant in the iChart.

```{r}
describeiChart(d) 
```

### Preprocess iChart

The following functions peform different preprocessing steps on the iChart. Critically, each function always returns an iChart.

  * `defineOnset()` flags each trial as Target-initial or Distractor-initial depending on where child was looking at F0
  * `computeStatistics()` computes a series of variables for each trial (see the function documentation for more details)
  * `filteriChart()` creates a variable defining whether each trial is "good" based on the user-specified exclusionary criteria
  
** Note that you can choose to save the results of each processing step to a .txt file if you set `save_results = TRUE` **

```{r}
d <- defineOnset(d, critonset = 300, includeAways = FALSE)
d <- computeStatistics(d, startWindow=0, endWindow=2300, save_results = TRUE)
d <- filteriChart(d, minRT=300, maxRT=1800, maxfirstgap=15, maxlonggap=15, save_results = TRUE)
```

### Filter out Prescreened Trials

```{r}
d_analysis <- filterPrescreened(d, save_results = TRUE)
```

Check to see how many trails are left for each participant.

```{r}
describeiChart(d_analysis)
```

### Rename condition

```{r}
d_analysis <- renameCondition(d_analysis, oldCondition = "Experimental", newCondition = "Vanilla")
```

Check to see if conditions were renamed correctly.

```{r}
describeiChart(d_analysis)
```

### Filter out unknown words

`removeUnknownWords()` removes all trials for words that parents reported their children did not know. First, we read in a .txt file containing as a data frame of unknown words for each participant. This is what the file should look like.

```{r}
# d_unknown <- readr::read_delim("Habla2_25_unknown_words.txt", delim = "\t")
d_unknown <- demo_unknown_words
head(d_unknown)
```

Next, we use the unknown words information to filter out trials from the iChart.

```{r}
d_analysis <- removeUnknownWords(d_analysis, d_unknown)
```

To sum up, the previous processint steps removed:

  * prescreened trials
  * trials with unknown words
  * trials that did not meet other inclusionary criterions set in the `filteriChart()` step

After processing, we now have an iChart that is ready to be analyzed. 

### Aggregate Accuracy

```{r}
## Compute aggregate accuracy and RT
acc <- poolData(d_analysis,
                dependent="Accuracy",
                include_T_initial = TRUE,
                RejectFirstGap=FALSE,
                RejectLongestGap=FALSE,
                RejectRT=FALSE,
                paired = TRUE,
                save_results = TRUE)

print(acc)
```

### Aggregate RT

```{r}
rt <- poolData(d_analysis,
               dependent = "RT",
               include_T_initial = FALSE,
               RejectFirstGap = TRUE,
               RejectLongestGap = TRUE,
               RejectRT = TRUE,
               paired = TRUE,
               save_results = TRUE)

print(rt)
```

## Generate plots

### Make a Profile Plot

```{r, eval = F}
createPlots(d_analysis,
            plotStats="PP",
            startWindow=300, endWindow=3000,
            RejectLongestGap=FALSE,
            RejectFirstGap = FALSE,
            RejectRT = FALSE,
            group="")
```

### Make an OC Plot

```{r, eval = F}
createPlots(d_analysis,
            plotStats="OC",
            startWindow=300, endWindow=3000,
            RejectLongestGap=FALSE,
            RejectFirstGap = FALSE,
            RejectRT = FALSE,
            group="")
```
